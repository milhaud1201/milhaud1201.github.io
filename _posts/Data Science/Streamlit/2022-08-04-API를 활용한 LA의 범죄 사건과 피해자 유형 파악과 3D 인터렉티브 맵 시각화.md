---
title: APIë¥¼ í™œìš©í•œ LAì˜ ë²”ì£„ ì‚¬ê±´ê³¼ í”¼í•´ì ìœ í˜• íŒŒì•…ê³¼ 3D ì¸í„°ë ‰í‹°ë¸Œ ë§µ ì‹œê°í™”
date: 2022-08-04T09:23:28.272Z
categories: [Data Science, Streamlit]
tags: [data science, streamlit, data visualization]		# TAGëŠ” ë°˜ë“œì‹œ ì†Œë¬¸ì
---

# Stremlitì´ë€?
ë°ì´í„° ê³¼í•™ìë“¤ì´ ë°ì´í„° ì‹œê°í™”, ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ë§, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ì„ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. Streamlitì„ ì‚¬ìš©í•˜ë©´ íŒŒì´ì¬ ì½”ë“œë§Œìœ¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ ìˆ˜ ìˆì–´ì„œ, ë°ì´í„° ë¶„ì„ê³¼ ëª¨ë¸ë§ ê²°ê³¼ë¥¼ ê³µìœ í•˜ê±°ë‚˜ ì¸í„°ë™í‹°ë¸Œí•œ ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“œëŠ” ë“± ë‹¤ì–‘í•œ ìš©ë„ë¡œ í™œìš©í•  ìˆ˜ ìˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ë©°, íŒŒì´ì¬ ì½”ë“œì™€ í•¨ê»˜ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— ê°œë°œìë“¤ì´ ì‰½ê²Œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤.

## ê°„ë‹¨í•œ ì‚¬ìš©ë²• ì•Œì•„ë³´ê¸°

```python
# app.py
import streamlit as st

st.title("Hello world")
``` 
í„°ë¯¸ë„ì—ì„œ ì•„ë˜ì˜ ì½”ë“œë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¡œì»¬í˜¸ìŠ¤íŠ¸ ì„œë²„ê°€ ì‹¤í–‰ëœë‹¤.
```terminal
streamlit run app.py
```

  You can now view your Streamlit app in your browser.  

  Local URL: http://localhost:8501   
  Network URL: http://192.168.0.5:8501  

> streamlitì€ markdown ë¬¸ë²•ì„ ì§€ì›í•œë‹¤.

```python
# app.py
import streamlit as st

st.title("Hello world")
st.markdown("# My first streamlit dashboard!")
st.markdown("## My first streamlit dashboard!")
st.markdown("### My first streamlit dashboard!")
st.markdown("* ì•ˆë…•í•˜ì„¸ìš” _Milhuad_ ì…ë‹ˆë‹¤.")
st.markdown("* ì•ˆë…•í•˜ì„¸ìš” **Milhuad** ì…ë‹ˆë‹¤.")
st.markdown("* ì•ˆë…•í•˜ì„¸ìš” `Milhuad` ì…ë‹ˆë‹¤.")
```
![streamlit_helloworld](/assets/img/to/streamlit_markdown.png)

# Task 1
Crime Data from 2020 to Present ë¡œë“œí•˜ê¸°

1. ë°ì´í„°í”„ë ˆì„ì˜ `date_rptd` ì»¬ëŸ¼ì„ pop part í•´ì„œ pandasì˜ date/time í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•œë‹¤.
2. ê²½ë„ì™€ ìœ„ë„ì˜ ê²°ì¸¡ê°’ì€ 3ì°¨ì› ì§€ë„ ì‹œê°ì—ì„œ ê¹¨ì§ˆ ê²ƒì´ê¸°ì—  `dropna` í•œë‹¤.  

```python
import streamlit as st
import pandas as pd
import numpy as np


# API Endpoint
DATA_URL = (
	"https://data.lacity.org/resource/2nrs-mtv8.csv?$query=SELECT%0A%20%20%60dr_no%60%2C%0A%20%20%60date_rptd%60%2C%0A%20%20%60date_occ%60%2C%0A%20%20%60time_occ%60%2C%0A%20%20%60area%60%2C%0A%20%20%60area_name%60%2C%0A%20%20%60rpt_dist_no%60%2C%0A%20%20%60part_1_2%60%2C%0A%20%20%60crm_cd%60%2C%0A%20%20%60crm_cd_desc%60%2C%0A%20%20%60mocodes%60%2C%0A%20%20%60vict_age%60%2C%0A%20%20%60vict_sex%60%2C%0A%20%20%60vict_descent%60%2C%0A%20%20%60premis_cd%60%2C%0A%20%20%60premis_desc%60%2C%0A%20%20%60weapon_used_cd%60%2C%0A%20%20%60weapon_desc%60%2C%0A%20%20%60status%60%2C%0A%20%20%60status_desc%60%2C%0A%20%20%60crm_cd_1%60%2C%0A%20%20%60crm_cd_2%60%2C%0A%20%20%60crm_cd_3%60%2C%0A%20%20%60crm_cd_4%60%2C%0A%20%20%60location%60%2C%0A%20%20%60cross_street%60%2C%0A%20%20%60lat%60%2C%0A%20%20%60lon%60")

st.title("Incidents of crime in the City of LA")
st.markdown("Streamlit dashboardë¥¼ ì´ìš©í•œ LAì˜ ë²”ì£„ ì‚¬ê±´ Application ğŸš—ğŸ’¥")

# rowê°œìˆ˜ì— ë”°ë¼ ë°ì´í„° ë³´ì—¬ì£¼ê¸°
@st.cache(persist=True)
def load_data(nrows):
	data = pd.read_csv(DATA_URL, nrows=nrows, parse_dates=['date_rptd'])
	data = data.dropna(subset=['lat', 'lon'])
	lowercase = lambda x: str(x).lower()
	data = data.rename(lowercase, axis='columns')
	data = data.sort_values(by='date_rptd', ascending=False)
	return data

data = load_data(100000)

if st.checkbox("Show Raw Data", False):
	st.subheader('Raw Data')
	st.write(data)
```

ì²´í¬ë°•ìŠ¤ ìœ ë¬´ì— ë”°ë¼ ë°ì´í„° í”„ë ˆì„ì„ ë³´ì—¬ì¤€ë‹¤.
![streamlit_loaddata](/assets/img/to/streamlit_loaddata.png)

# Task 2
ë°ì´í„° ì§€ë„ ì‹œê°í™”í•˜ê¸°  

```python
st.header("Where is the most place for crime in LA?")
crime = st.slider("Number of crime in LA", 0, 19)
st.map(data.query("area >= @crime")[['lat', 'lon']].dropna(how='any'))
```

![streamlit_loaddata](/assets/img/to/streamlit_map.png)

# Task 3
* ë°ì´í„° í•„í„°ë§, ì¸í„°ë ‰í‹°ë¸Œ í…Œì´ë¸”
* 3D ì¸í„°ë ‰í‹°ë¸Œ ë§µ ìœ„ì— ì „ì²˜ë¦¬í•œ ë°ì´í„° Plot ê·¸ë¦¬ê¸°
```python
import pydeck as pdk


st.header("What is the number of victims by age?")
age_range = st.slider("Victims by age to look at", 0, 100, (0, 100))
data = data[(data['vict_age'] >= age_range[0]) & (data['vict_age'] <= age_range[1])]

st.markdown("í¬ìƒìì˜ ë‚˜ì´ëŠ” %ië¶€í„° %iê¹Œì§€ì…ë‹ˆë‹¤" % (age_range[0], age_range[1]))
st.markdown("ì´ %iëª… ì…ë‹ˆë‹¤" % len(data))
midpoint = (np.average(data['lat']), np.average(data['lon']))

st.write(pdk.Deck(
	map_style="mapbox://styles/mapbox/light-v9",
	initial_view_state={
		"latitude": midpoint[0],
		"longitude": midpoint[1],
		"zoom": 11,
		"pitch": 50,
	},
	layers=[
		pdk.Layer(
		"HexagonLayer", 
		data=data[['vict_age', 'lat', 'lon']],
		get_position=['lon', 'lat'],
		radius=100,
		extruded=True,
		pickable=True,
		elevation_scale=4,
		elevation_range=[0, 1000],
		),
	],
))
```
![streamlit_loaddata](/assets/img/to/streamlit_3dmap.png)

# Task 5
* ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    1. ë°ì´í„° í”„ë ˆì„ ì •ì˜í•˜ê¸°
    2. groupbyë¡œ countí•  ë°ì´í„° ê·¸ë£¹í•‘í•˜ê¸°
    3. plotly express barë¡œ count bar plot ê·¸ë¦¬ê¸°
```python
st.subheader("The number of victims by descent and sex")
chart_data = pd.DataFrame({
	'crime_cd': data['crm_cd'],
	'type': data['crm_cd_desc'],
	'descent': data['vict_descent'],
	'sex': data['vict_sex'],
})
chart_data = chart_data.groupby(by=['descent', 'sex']).size().reset_index(name='counts')
fig = px.bar(chart_data, x='descent', y='counts' , color='sex', barmode='group', height=800)
# fig.update_layout(yaxis={'categoryorder':'total ascending'})
st.write(fig)
```
![streamlit_loaddata](/assets/img/to/streamlit_chart.png)

# Task 6
ë“œë¡­ ë‹¤ìš´ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì„ íƒí•˜ê¸°
```python
st.header("Top 5 type of crimes")
select = st.selectbox('The types of crimes & area', 
	['Vehicle - Stolen', 'Battery - Simple assault', 'Theft of identity', 'Burglary from vehicle', 'Andalism - Felony']
)

if select == 'Vehicle - Stolen':
	st.write(data.query("crm_cd_desc == 'VEHICLE - STOLEN'")[["crm_cd_desc", "area_name", "premis_desc"]].sort_values(by=["crm_cd_desc"], ascending=False).dropna(how='any'), width=1000)

elif select == 'Battery - Simple assault':
	st.write(data.query("crm_cd_desc == 'BATTERY - SIMPLE ASSAULT'")[["crm_cd_desc", "area_name", "premis_desc"]].sort_values(by=["crm_cd_desc"], ascending=False).dropna(how='any'), width=1000)

elif select == 'Theft of identity':
	st.write(data.query("crm_cd_desc == 'THEFT OF IDENTITY'")[["crm_cd_desc", "area_name", "premis_desc"]].sort_values(by=["crm_cd_desc"], ascending=False).dropna(how='any'), width=1000)

elif select == 'Burglary from vehicle':
	st.write(data.query("crm_cd_desc == 'BURGLARY FROM VEHICLE'")[["crm_cd_desc", "area_name", "premis_desc"]].sort_values(by=["crm_cd_desc"], ascending=False).dropna(how='any'), width=1000)

elif select == 'Andalism - Felony':
	st.write(data.query("crm_cd_desc == 'VANDALISM - FELONY ($400 & OVER, ALL CHURCH VANDALISMS)'")[["crm_cd_desc", "area_name", "premis_desc"]].sort_values(by=["crm_cd_desc"], ascending=False).dropna(how='any'), width=1000)
```
![streamlit_loaddata](/assets/img/to/streamlit_dropdown.png)

ë°ì´í„° ë¡œë“œì™€ ê°„ë‹¨í•œ ë°ì´í„° ì „ì²˜ë¦¬, 3D ì§€ë„ ì‹œê°í™”, Bar chartë¥¼ ê·¸ë ¸ë‹¤. ë³¸ ê¸€ì—ì„œ ë°ì´í„° ì „ì²˜ë¦¬ì— ëŒ€í•œ ë””í…Œì¼ì€ ì¡°ê¸ˆ ë–¨ì–´ì§€ì§€ë§Œ, ì´ì •ë„ë§Œ ì•Œì•„ë„ streamlitì„ ë‹¤ë£¨ê¸°ì—” ì¶©ë¶„í•˜ë‹¤.

ë°ëª¨ ì˜ìƒê³¼ ì „ì²´ ì½”ë“œëŠ” [ì—¬ê¸°](https://github.com/milhaud1201/Incidents-of-crime-in-LA-with-Streamlit)ì— ìˆìŠµë‹ˆë‹¤.

# Reference
* [Crime Data from 2020 to Present](https://data.lacity.org/Public-Safety/Crime-Data-from-2020-to-Present/2nrs-mtv8)
    *  Data Provided by Los Angeles Police Department